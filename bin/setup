#!/bin/bash
set -e
cd $(pwd $0)

# Configure nfs for docker machine
if [ "$DOCKER_MACHINE_NAME" ]; then
  docker-machine-nfs $DOCKER_MACHINE_NAME --nfs-config="-alldirs -maproot=0" --mount-opts="noacl,async,nolock,vers=3,udp,noatime,actimeo=1"
fi

# Generate private key
if [ ! -f ~/.ssh/id_rsa.pub ]; then
  ssh-keygen -t rsa
fi

# Setup public key
mkdir -p ./www/.ssh
cat ~/.ssh/id_rsa.pub > ./www/.ssh/authorized_keys

# Setup environment file
USER_ID=$(id -u)
cat <<EOF > ./configs/env_user
USER_ID=$USER_ID
USER_CREATE=$USER
EOF
